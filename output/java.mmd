%% Generated from PlantUML - Mermaid Class Diagram
%% Note: This is a large diagram. Consider using Mermaid Live Editor for rendering.
%% URL: https://mermaid.live/

classDiagram
    direction TB

    %% ==================== MAIN CLASSES ====================

    class MainLayout {
        -Logger logger$
        -StackPane contentArea
        -ViewFactory viewFactory
        -NavigationManager navigationManager
        -FloatingNavBar floatingNavBar
        -CustomTitleBar titleBar
        -double CORNER_RADIUS$
        +MainLayout()
        +MainLayout(Stage stage)
        -initializeLayout() void
        -initializeLayoutWithTitleBar(Stage stage) void
        -handleNavigation(String viewType) void
        -handleSearch(String query) void
        -updateButtonStates(String activeViewType) void
        +getTitleBar() CustomTitleBar
        +getFloatingNavBar() FloatingNavBar
        +refreshTheme() void
        +navigateTo(String viewType) void
    }

    class RoamApplication {
        -Logger logger$
        +start(Stage primaryStage) void
        +stop() void
        -loadFonts() void
        -setupGlobalShortcuts(Scene scene, Stage stage, MainLayout mainLayout) void
        -openGlobalSearch(Stage owner, MainLayout mainLayout) void
        -showErrorDialog(String title, String header, String content) void
        +main(String[] args)$ void
    }

    %% ==================== CONTROLLERS ====================

    class CalendarController {
        -Logger logger$
        -CalendarService calendarService
        -CalendarEventRepository eventRepository
        -CalendarSourceRepository sourceRepository
        -OperationRepository operationRepository
        -TaskRepository taskRepository
        -RegionRepository regionRepository
        -WikiRepository WikiRepository
        -List~CalendarSource~ calendarSources
        -List~CalendarEvent~ allEvents
        -Runnable onDataChanged
        +CalendarController()
        +setOnDataChanged(Runnable handler) void
        +getCalendarSources() List~CalendarSource~
        +getEventsForDate(LocalDate date) List~CalendarEvent~
        +getAllEvents() List~CalendarEvent~
        +createEvent(LocalDate date) void
        +editEvent(CalendarEvent event) void
        +deleteEvent(CalendarEvent event) void
    }

    class JournalController {
        -Logger logger$
        -JournalService journalService
        -JournalTemplateRepository templateRepository
        -Runnable onDataChanged
        +JournalController()
        +loadAllEntries() List~JournalEntry~
        +getEntryForDate(LocalDate date) Optional~JournalEntry~
        +createEntry(LocalDate date) JournalEntry
        +saveEntry(JournalEntry entry) void
        +deleteEntry(JournalEntry entry) void
        +loadTemplates() List~JournalTemplate~
    }

    class OperationDetailController {
        -Logger logger$
        -OperationRepository operationRepository
        -TaskRepository taskRepository
        -WikiRepository WikiRepository
        -RegionRepository regionRepository
        -CalendarEventRepository eventRepository
        -Operation operation
        -Runnable onDataChanged
        +OperationDetailController(Operation operation)
        +getOperation() Operation
        +refreshOperation() void
        +updateOperation(Operation updatedOperation) void
        +loadTasks() List~Task~
        +createTask(TaskStatus initialStatus) void
        +loadWikis() List~Wiki~
    }

    class OperationsController {
        -Logger logger$
        -OperationService operationService
        -RegionRepository regionRepository
        -OperationTableView tableView
        -Runnable onDataChanged
        +OperationsController()
        +loadOperations() List~Operation~
        +createOperation() void
        +editOperation(Operation operation) void
        +deleteOperation(Operation operation) void
        +refreshTable() void
    }

    class TasksController {
        -Logger logger$
        -TaskService taskService
        -TaskRepository taskRepository
        -OperationRepository operationRepository
        -RegionRepository regionRepository
        -CalendarEventRepository eventRepository
        -WikiRepository WikiRepository
        -TaskFilter currentFilter
        -ObservableSet~Task~ selectedTasks
        -Runnable onDataChanged
        +TasksController()
        +createTask() void
        +editTask(Task task) void
        +deleteTask(Long taskId) void
        +updateTaskStatus(Long taskId, TaskStatus newStatus) void
        +loadTasks() List~Task~
        +applyFilter(TaskFilter filter) void
        +calculateStats() TaskStats
    }

    class TaskStats {
        -long total
        -long todoCount
        -long inProgressCount
        -long doneCount
        -long highPriorityCount
        -long overdueCount
        +TaskStats(long, long, long, long, long, long)
        +getTotal() long
        +getTodoCount() long
        +getInProgressCount() long
        +getDoneCount() long
    }

    class WikiController {
        -Logger logger$
        -WikiService wikiService
        -WikiTemplateRepository templateRepository
        -OperationRepository operationRepository
        -RegionRepository regionRepository
        -TaskRepository taskRepository
        -CalendarEventRepository eventRepository
        -Wiki currentWiki
        -ObservableList~Wiki~ allWikis
        -FilteredList~Wiki~ filteredWikis
        -StringProperty searchQuery
        -ObjectProperty~Operation~ selectedOperation
        -Timeline autoSaveTimer
        +WikiController()
        +loadAllWikis() List~Wiki~
        +createNewWiki() Wiki
        +saveCurrentWiki() void
        +deleteWiki(Wiki wiki) void
        +loadAllTemplates() List~WikiTemplate~
    }

    class BaseController {
        <<abstract>>
        #Logger logger
        #handleException(String operation, Exception e) void
        #showError(String title, String header, String content) void
        #showConfirmation(String title, String header, String content) boolean
    }

    class RefreshableController {
        <<interface>>
        +refresh() void
        +setOnDataChanged(Runnable callback) void
    }

    %% ==================== LAYOUT COMPONENTS ====================

    class CustomTitleBar {
        -Logger logger$
        -Stage stage
        -ImageView iconView
        -Button minimizeBtn
        -Button maximizeBtn
        -Button closeBtn
        -Button settingsBtn
        -boolean isMaximized
        +CustomTitleBar(Stage stage)
        +isMaximized() boolean
        +setOnNavigate(Consumer~String~ onNavigate) void
        +applyTheme() void
        +refreshTheme() void
    }

    class DialogTitleBar {
        -Stage stage
        -Label titleLabel
        +DialogTitleBar(Stage stage, String title)
        +setTitle(String title) void
        +refreshTheme() void
    }

    class FloatingNavBar {
        -Logger logger$
        -HBox navBar
        -Map~String,Button~ navigationButtons
        -Button searchBtn
        -TextField searchField
        -HBox searchContainer
        -boolean searchExpanded
        -Consumer~String~ onNavigate
        -Consumer~String~ onSearch
        +FloatingNavBar(Consumer~String~ onNavigate, Consumer~String~ onSearch)
        +setActiveButton(String viewType) void
        +getNavigationButtons() Map~String,Button~
        +applyTheme() void
        +refreshTheme() void
    }

    class NavigationManager {
        -Logger logger$
        -StackPane contentArea
        -ViewFactory viewFactory
        -Map~String,Button~ navigationButtons
        -Consumer~String~ buttonStateUpdater
        -Operation currentOperation
        -Node previousView
        -String currentViewType
        +NavigationManager(StackPane, ViewFactory, Map~String,Button~, Consumer~String~)
        +navigateToView(String viewType) void
        +navigateToOperationDetail(Operation operation) void
        +navigateBackToOperations() void
        +performSearch(String query) void
    }

    class SidebarComponent {
        -Logger logger$
        -VBox sidebar
        -Map~String,Button~ navigationButtons
        -HBox headerBox
        -VBox headerCol
        -Button menuBtn
        -boolean collapsed
        -Consumer~String~ onNavigate
        -Consumer~String~ onSearch
        +SidebarComponent(Consumer~String~, Consumer~String~, Runnable, Region)
    }

    %% ==================== MODELS ====================

    class CalendarEvent {
        -Long id
        -Long calendarSourceId
        -Long operationId
        -Long taskId
        -String title
        -String description
        -String location
        -LocalDateTime startDateTime
        -LocalDateTime endDateTime
        -Boolean isAllDay
        -String color
        -String recurrenceRule
        +CalendarEvent()
        +getId() Long
        +getTitle() String
        +getStartDateTime() LocalDateTime
        +getEndDateTime() LocalDateTime
    }

    class CalendarSource {
        -Long id
        -String name
        -String color
        -CalendarSourceType type
        -Boolean isVisible
        -Boolean isDefault
        -LocalDateTime createdAt
        +CalendarSource()
        +CalendarSource(String name, String color, CalendarSourceType type)
        +getId() Long
        +getName() String
        +getColor() String
    }

    class JournalEntry {
        -Long id
        -String title
        -String content
        -LocalDate date
        -LocalDateTime createdAt
        -LocalDateTime updatedAt
        +JournalEntry()
        +JournalEntry(String title, LocalDate date)
        +getId() Long
        +getTitle() String
        +getContent() String
    }

    class JournalTemplate {
        -Long id
        -String name
        -String content
        -LocalDateTime createdAt
        +JournalTemplate()
        +JournalTemplate(String name, String content)
        +getId() Long
        +getName() String
    }

    class Operation {
        -Long id
        -String name
        -String purpose
        -LocalDate dueDate
        -OperationStatus status
        -String outcome
        -Priority priority
        -LocalDateTime createdAt
        -String region
        +Operation()
        +Operation(String name)
        +getId() Long
        +getName() String
        +getStatus() OperationStatus
        +getPriority() Priority
    }

    class Region {
        -Long id
        -String name
        -String color
        -Boolean isDefault
        -LocalDateTime createdAt
        +String[] DEFAULT_REGIONS$
        +String[] DEFAULT_COLORS$
        +Region()
        +Region(String name, String color, boolean isDefault)
        +getId() Long
        +getName() String
        +getColor() String
    }

    class Settings {
        -boolean isLockEnabled
        -String pinHash
        -String theme
        -String userName
        -String profileImagePath
        -List~String~ regions
        -String firstDayOfWeek
        -String timezone
        +Settings()
        +isLockEnabled() boolean
        +getTheme() String
        +getUserName() String
    }

    class Task {
        -Long id
        -Long operationId
        -String title
        -String description
        -TaskStatus status
        -LocalDateTime dueDate
        -String assignee
        -Priority priority
        -Integer position
        -String region
        -Long calendarEventId
        -Long wikiId
        -String recurrenceRule
        +Task()
        +Task(String title, Long operationId)
        +getId() Long
        +getTitle() String
        +getStatus() TaskStatus
        +getPriority() Priority
    }

    class TaskFilter {
        -List~Long~ operationIds
        -List~TaskStatus~ statuses
        -List~Priority~ priorities
        -List~String~ assignees
        -DueDateFilter dueDateFilter
        -String searchQuery
        -TaskSortField sortBy
        -SortOrder sortOrder
        -Boolean showCompleted
        +TaskFilter()
        +isFilterActive() boolean
        +reset() void
        +clone() TaskFilter
    }

    class Wiki {
        -Long id
        -Long operationId
        -String title
        -String content
        -LocalDateTime createdAt
        -LocalDateTime updatedAt
        -Boolean isFavorite
        -Long templateId
        -Integer wordCount
        -String linkedWikiIds
        -String region
        -Long taskId
        -Long calendarEventId
        -String bannerUrl
        -String backgroundColor
        +Wiki()
        +Wiki(String title, Long operationId)
        +getId() Long
        +getTitle() String
        +getContent() String
    }

    class WikiFileAttachment {
        -Long id
        -Long wikiId
        -String fileName
        -String filePath
        -Long fileSize
        -String fileType
        -LocalDateTime createdAt
        -String description
        +WikiFileAttachment()
        +getId() Long
        +getFileName() String
    }

    class WikiTemplate {
        -Long id
        -String name
        -String description
        -String content
        -String icon
        -Boolean isDefault
        +String PLACEHOLDER_DATE$
        +String PLACEHOLDER_TIME$
        +WikiTemplate()
        +WikiTemplate(String, String, String, String, boolean)
        +getId() Long
        +getName() String
        +processTemplate(String title, String operationName) String
    }

    class BaseEntity {
        <<abstract>>
        -Long id
        -LocalDateTime createdAt
        -LocalDateTime updatedAt
        #onCreate() void
        #onUpdate() void
        +getId() Long
        +getCreatedAt() LocalDateTime
    }

    %% ==================== REPOSITORIES ====================

    class CalendarEventRepository {
        -Logger logger$
        +save(CalendarEvent event) CalendarEvent
        +findById(Long id) Optional~CalendarEvent~
        +findAll() List~CalendarEvent~
        +findByDateRange(LocalDateTime, LocalDateTime) List~CalendarEvent~
        +findByOperationId(Long operationId) List~CalendarEvent~
        +delete(Long id) void
    }

    class CalendarSourceRepository {
        -Logger logger$
        +save(CalendarSource source) CalendarSource
        +findById(Long id) Optional~CalendarSource~
        +findAll() List~CalendarSource~
        +findVisible() List~CalendarSource~
        +findDefault() Optional~CalendarSource~
        +delete(Long id) void
    }

    class JournalEntryRepository {
        +save(JournalEntry entry) JournalEntry
        +findById(Long id) Optional~JournalEntry~
        +findAll() List~JournalEntry~
        +findByDate(LocalDate date) Optional~JournalEntry~
        +delete(JournalEntry entry) void
    }

    class JournalTemplateRepository {
        +save(JournalTemplate template) JournalTemplate
        +findById(Long id) Optional~JournalTemplate~
        +findAll() List~JournalTemplate~
        +delete(JournalTemplate template) void
    }

    class OperationRepository {
        -Logger logger$
        -ValidationService validationService
        +save(Operation operation) Operation
        +findById(Long id) Optional~Operation~
        +findAll() List~Operation~
        +findByStatus(OperationStatus status) List~Operation~
        +findByPriority(Priority priority) List~Operation~
        +delete(Long id) void
        +count() long
    }

    class RegionRepository {
        -Logger logger$
        +save(Region region) Region
        +findById(Long id) Optional~Region~
        +findAll() List~Region~
        +findByName(String name) Optional~Region~
        +findCustomRegions() List~Region~
        +delete(Long id) void
        +createDefaultRegions() void
    }

    class TaskRepository {
        -Logger logger$
        +save(Task task) Task
        +findById(Long id) Optional~Task~
        +findByOperationId(Long operationId) List~Task~
        +delete(Long id) void
        +findAll() List~Task~
        +findWithFilters(TaskFilter filter) List~Task~
        +countByStatus(TaskStatus status) long
        +batchUpdateStatus(List~Long~ taskIds, TaskStatus newStatus) int
        +batchDelete(List~Long~ taskIds) int
    }

    class WikiRepository {
        -Logger logger$
        -ValidationService validationService
        +save(Wiki wiki) Wiki
        +findById(Long id) Optional~Wiki~
        +findByOperationId(Long operationId) List~Wiki~
        +delete(Long id) void
        +findAll() List~Wiki~
        +findFavorites() List~Wiki~
        +findRecent(int limit) List~Wiki~
        +searchFullText(String query) List~Wiki~
        +getTotalWordCount() long
    }

    class WikiFileAttachmentRepository {
        +save(WikiFileAttachment attachment) WikiFileAttachment
        +findById(Long id) Optional~WikiFileAttachment~
        +findByWikiId(Long wikiId) List~WikiFileAttachment~
        +delete(WikiFileAttachment attachment) void
        +deleteByWikiId(Long wikiId) void
    }

    class WikiTemplateRepository {
        -Logger logger$
        +save(WikiTemplate template) WikiTemplate
        +findById(Long id) Optional~WikiTemplate~
        +findAll() List~WikiTemplate~
        +findDefaults() List~WikiTemplate~
        +findCustom() List~WikiTemplate~
        +delete(Long id) void
    }

    class GenericRepository~T, ID~ {
        <<abstract>>
        -Logger logger$
        #Class~T~ entityClass
        #GenericRepository(Class~T~ entityClass)
        #getEntityManager() EntityManager
        +save(T entity) T
        +findById(ID id) Optional~T~
        +findAll() List~T~
        +delete(ID id) void
        +count() long
    }

    %% ==================== SERVICES ====================

    class CalendarService {
        <<interface>>
        +createEvent(CalendarEvent event) CalendarEvent
        +updateEvent(CalendarEvent event) CalendarEvent
        +deleteEvent(Long id) void
        +findById(Long id) Optional~CalendarEvent~
        +findAll() List~CalendarEvent~
        +findByDateRange(LocalDateTime, LocalDateTime) List~CalendarEvent~
        +syncTaskToCalendar(Long taskId) void
        +count() long
    }

    class CalendarServiceImpl {
        -Logger logger$
        -CalendarEventRepository repository
        -TaskRepository taskRepository
        -SearchService searchService
        +CalendarServiceImpl()
        +createEvent(CalendarEvent event) CalendarEvent
        +updateEvent(CalendarEvent event) CalendarEvent
        +deleteEvent(Long id) void
        +findAll() List~CalendarEvent~
        +syncTaskToCalendar(Long taskId) void
    }

    class DatabaseService {
        -Logger logger$
        +initializeDatabase()$ void
        +testConnection()$ boolean
        +getDatabasePath()$ String
    }

    class DataInitializer {
        -Logger logger$
        -WikiTemplateRepository templateRepository
        -RegionRepository regionRepository
        +DataInitializer()
        +initializeDefaultTemplates() void
    }

    class DataService {
        -OperationRepository operationRepository
        -TaskRepository taskRepository
        -RegionRepository regionRepository
        -CalendarEventRepository eventRepository
        -CalendarSourceRepository sourceRepository
        -WikiRepository WikiRepository
        -WikiTemplateRepository WikiTemplateRepository
        -JournalEntryRepository journalRepository
        -JournalTemplateRepository journalTemplateRepository
        -ObjectMapper objectMapper
        +DataService()
        +exportData(File exportFile) ExportResult
        +importData(File importFile, boolean mergeMode) ImportResult
    }

    class ExportResult {
        -boolean success
        -String message
        -int recordCount
        -String filePath
        +ExportResult(boolean, String, int, String)
        +isSuccess() boolean
        +getMessage() String
        +getRecordCount() int
    }

    class ImportResult {
        -boolean success
        -String message
        -int importedCount
        -int skippedCount
        +ImportResult(boolean, String, int, int)
        +isSuccess() boolean
        +getMessage() String
        +getImportedCount() int
    }

    class JournalService {
        <<interface>>
        +createEntry(JournalEntry entry) JournalEntry
        +updateEntry(JournalEntry entry) JournalEntry
        +deleteEntry(Long id) void
        +findById(Long id) Optional~JournalEntry~
        +findAll() List~JournalEntry~
        +findByDate(LocalDate date) List~JournalEntry~
        +count() long
    }

    class JournalServiceImpl {
        -Logger logger$
        -JournalEntryRepository repository
        -SearchService searchService
        +JournalServiceImpl()
        +createEntry(JournalEntry entry) JournalEntry
        +updateEntry(JournalEntry entry) JournalEntry
        +findAll() List~JournalEntry~
    }

    class OperationService {
        <<interface>>
        +createOperation(Operation operation) Operation
        +updateOperation(Operation operation) Operation
        +deleteOperation(Long id) void
        +findById(Long id) Optional~Operation~
        +findAll() List~Operation~
        +findByStatus(OperationStatus status) List~Operation~
        +count() long
    }

    class OperationServiceImpl {
        -Logger logger$
        -OperationRepository repository
        -CalendarEventRepository calendarEventRepository
        -TaskRepository taskRepository
        -SearchService searchService
        +OperationServiceImpl()
        +createOperation(Operation operation) Operation
        +updateOperation(Operation operation) Operation
        +deleteOperation(Long id) void
        +findAll() List~Operation~
    }

    class SearchService {
        -String INDEX_PATH$
        -SearchService instance$
        -Directory indexDirectory
        -StandardAnalyzer analyzer
        -IndexWriter indexWriter
        -SearchService()
        +getInstance()$ SearchService
        +indexWiki(Long, String, String, String, Long, LocalDateTime) void
        +indexTask(Long, String, String, String, String, Long, LocalDateTime) void
        +indexEvent(Long, String, String, LocalDateTime, LocalDateTime, String) void
        +indexOperation(Long, String, String, String, String, String) void
        +search(String queryString, SearchFilter filter) List~SearchResult~
        +clearIndex() void
        +rebuildIndex() void
        +close() void
    }

    class SearchResult {
        +Long id
        +String type
        +String title
        +String snippet
        +float score
        +String region
        +String operationId
        +String updatedAt
        +String priority
        +String status
    }

    class SearchFilter {
        +List~String~ types
        +String region
        +Long operationId
        +String priority
        +String status
        +int maxResults
        +SearchFilter()
    }

    class SecurityContext {
        -Logger logger$
        -SecurityContext instance$
        -boolean authenticated
        -BCryptPasswordEncoder passwordEncoder$
        -int MIN_PIN_LENGTH$
        -int failedAttempts
        +getInstance()$ SecurityContext
        +isAuthenticated() boolean
        +setAuthenticated(boolean authenticated) void
        +isLockEnabled() boolean
        +authenticate(String pin) boolean
        +setPin(String pin) void
        +disableLock() void
    }

    class SettingsService {
        -Logger logger$
        -String SETTINGS_FILE$
        -SettingsService instance$
        -Settings settings
        -ObjectMapper mapper
        +getInstance()$ SettingsService
        +getSettings() Settings
        +saveSettings() void
    }

    class TaskService {
        <<interface>>
        +createTask(Task task) Task
        +updateTask(Task task) Task
        +deleteTask(Long id) void
        +findById(Long id) Optional~Task~
        +findAll() List~Task~
        +findByOperationId(Long operationId) List~Task~
        +findOverdue() List~Task~
        +count() long
        +updateStatus(Long id, TaskStatus newStatus) Task
    }

    class TaskServiceImpl {
        -Logger logger$
        -TaskRepository repository
        -SearchService searchService
        +TaskServiceImpl()
        +createTask(Task task) Task
        +updateTask(Task task) Task
        +deleteTask(Long id) void
        +findAll() List~Task~
        +updateStatus(Long id, TaskStatus newStatus) Task
    }

    class ValidationService {
        -ValidationService instance$
        -Validator validator
        +getInstance()$ ValidationService
        +validate(T entity) void
        +validateAndGetViolations(T entity) Set~ConstraintViolation~
        +isValid(T entity) boolean
    }

    class WikiService {
        <<interface>>
        +createWiki(Wiki wiki) Wiki
        +updateWiki(Wiki wiki) Wiki
        +deleteWiki(Long id) void
        +findById(Long id) Optional~Wiki~
        +findAll() List~Wiki~
        +findByOperationId(Long operationId) List~Wiki~
        +findFavorites() List~Wiki~
        +findRecent(int limit) List~Wiki~
        +toggleFavorite(Long id) Wiki
    }

    class WikiServiceImpl {
        -Logger logger$
        -WikiRepository repository
        -SearchService searchService
        +WikiServiceImpl()
        +createWiki(Wiki wiki) Wiki
        +updateWiki(Wiki wiki) Wiki
        +deleteWiki(Long id) void
        +findAll() List~Wiki~
        +toggleFavorite(Long id) Wiki
    }

    class ServiceFactory {
        -ServiceFactory instance$
        -TaskService taskService
        -OperationService operationService
        -WikiService wikiService
        -CalendarService calendarService
        -JournalService journalService
        +getInstance()$ ServiceFactory
        +resetInstance()$ void
        +getTaskService() TaskService
        +getOperationService() OperationService
        +getWikiService() WikiService
        +getCalendarService() CalendarService
        +getJournalService() JournalService
    }

    %% ==================== UTILITIES ====================

    class AnimationUtils {
        +Duration FAST$
        +Duration NORMAL$
        +Duration SLOW$
        +Interpolator EASE_OUT$
        +Interpolator SPRING$
        +fadeIn(Node node, Duration duration)$ void
        +slideInFromBottom(Node node)$ void
        +scaleIn(Node node)$ void
        +popIn(Node node)$ void
        +addHoverScale(Node node, double scaleFactor)$ void
        +fadeOut(Node node, Duration duration, Runnable onFinished)$ void
    }

    class DatabaseConfig {
        -Logger logger$
        -DatabaseConfig instance$
        -String jdbcUrl
        -String username
        -String password
        -String driver
        +getInstance()$ DatabaseConfig
        +getJdbcUrl() String
        +getUsername() String
        +getPassword() String
        +getDriver() String
    }

    class DialogUtils {
        +showConfirmation(String, String, String)$ boolean
        +showError(String, String, String)$ void
        +showInfo(String, String, String)$ void
        +showSuccess(String message)$ void
        +styleDialogPane(Dialog dialog)$ void
        +showDeleteConfirmation(String, String, String)$ boolean
    }

    class ExportUtils {
        -Logger logger$
        -ObjectMapper objectMapper$
        +exportWikiToMarkdown(Wiki Wiki, Window owner)$ void
        +exportAllWikisToMarkdown(Window owner, List~Wiki~ wikis)$ void
        +exportEventsToICS(Window owner, List~CalendarEvent~ events)$ void
        +exportOperationsToJSON(Window owner, List~Operation~ operations)$ void
        +exportJournalsToMarkdown(Window owner, List~JournalEntry~ entries)$ void
    }

    class FlywayManager {
        -Logger logger$
        -Flyway flyway$
        +runMigrations(String jdbcUrl, String username, String password)$ boolean
        +validate()$ boolean
        +repair()$ boolean
        +getInfo()$ String
    }

    class HibernateUtil {
        -Logger logger$
        -String PERSISTENCE_UNIT_NAME$
        -EntityManagerFactory entityManagerFactory$
        +getEntityManagerFactory()$ EntityManagerFactory
        +getEntityManager()$ EntityManager
        +shutdown()$ void
    }

    class IconUtil {
        +createIcon(Feather icon)$ FontIcon
        +createIcon(Feather icon, int size)$ FontIcon
        +star()$ Node
        +starFilled()$ Node
        +calendar()$ Node
        +clipboard()$ Node
        +edit()$ Node
        +search()$ Node
        +settings()$ Node
        +trash()$ Node
    }

    class ImportUtils {
        -Logger logger$
        -DateTimeFormatter ICS_DATE_FORMAT$
        +importWikisFromMarkdown(Window owner)$ List~Wiki~
        +importEventsFromICS(Window owner)$ List~CalendarEvent~
        +importOperationsFromJSON(Window owner)$ List~Operation~
        +importJournalsFromMarkdown(Window owner)$ List~JournalEntry~
    }

    class InputSanitizer {
        +int MAX_SEARCH_QUERY_LENGTH$
        +int MAX_TITLE_LENGTH$
        +int MAX_CONTENT_LENGTH$
        +sanitizeSearchQuery(String query)$ String
        +sanitizeForJPQL(String input)$ String
        +sanitizeHtml(String html)$ String
        +sanitizeTitle(String title)$ String
        +sanitizeContent(String content)$ String
        +validateNotEmpty(String value, String fieldName)$ void
        +stripHtmlTags(String html)$ String
        +truncate(String text, int maxLength)$ String
    }

    class MarkdownUtils {
        -Pattern WIKI_LINK_PATTERN$
        +processWikiLinks(String markdown)$ String
    }

    class StyleBuilder {
        -StringBuilder style
        +create()$ StyleBuilder
        +from(String existingStyle)$ StyleBuilder
        +backgroundColor(String cssVariable) StyleBuilder
        +backgroundRadius() StyleBuilder
        +borderColor(String cssVariable) StyleBuilder
        +textFill(String cssVariable) StyleBuilder
        +fontSize(int size) StyleBuilder
        +padding(int padding) StyleBuilder
        +cardShadow() StyleBuilder
        +build() String
    }

    class ThemeManager {
        -Logger logger$
        -ThemeManager instance$
        -String currentTheme
        -Scene mainScene
        -List~Runnable~ listeners
        +getInstance()$ ThemeManager
        +setMainScene(Scene scene) void
        +addListener(Runnable listener) void
        +applyTheme(String themeName) void
        +getCurrentTheme() String
        +isDarkTheme() boolean
        +styleDialog(Dialog dialog) void
        +styleAlert(Alert alert) void
    }

    class ThreadPoolManager {
        -Logger logger$
        -long SHUTDOWN_TIMEOUT_SECONDS$
        -ThreadPoolManager instance$
        -ExecutorService ioPool
        -ExecutorService computePool
        -ScheduledExecutorService scheduledPool
        +getInstance()$ ThreadPoolManager
        +getIoPool() ExecutorService
        +getComputePool() ExecutorService
        +submitIoTask(Runnable task) Future
        +submitComputeTask(Runnable task) Future
        +shutdown() void
        +gracefulShutdown() void
    }

    class UIConstants {
        +int RADIUS_STANDARD$
        +int RADIUS_SMALL$
        +int SPACING_XS$
        +int SPACING_SM$
        +int SPACING_MD$
        +String BG_PRIMARY$
        +String TEXT_PRIMARY$
        +String TEXT_SECONDARY$
        +String BLUE$
        +String RED$
        +String GREEN$
        +String SHADOW_CARD$
        +String FONT_REGULAR$
        +int FONT_SIZE_STANDARD$
        +int BUTTON_HEIGHT$
    }

    class AppConstants {
        +int DEFAULT_WINDOW_WIDTH$
        +int DEFAULT_WINDOW_HEIGHT$
        +int MIN_WINDOW_WIDTH$
        +int MIN_WINDOW_HEIGHT$
        +int SIDEBAR_WIDTH$
        +int ANIMATION_FAST$
        +int DEFAULT_PAGE_SIZE$
        +int SEARCH_RESULTS_LIMIT$
        +String DATE_FORMAT$
        +String APP_NAME$
        +String APP_VERSION$
    }

    %% ==================== VIEWS ====================

    class CalendarView {
        -CalendarController controller
        -Label dateLabel
        -VBox filterPanel
        -StackPane calendarContainer
        -FlowPane legendContainer
        -ViewType currentViewType
        -YearMonth currentYearMonth
        -LocalDate currentDate
        +CalendarView(CalendarController controller)
    }

    class JournalView {
        -JournalController controller
        -VBox contentPane
        -TextArea editorArea
        -Label dateLabel
        -Label wordCountLabel
        -JournalEntry currentEntry
        -LocalDate currentDate
        -boolean hasUnsavedChanges
        +JournalView()
    }

    class LockScreen {
        -Runnable onUnlock
        -Label messageLabel
        -List~Circle~ pinDots
        -StringBuilder currentPin
        -int PIN_LENGTH
        +LockScreen(Runnable onUnlock)
    }

    class LockScreenLayout {
        -CustomTitleBar titleBar
        -LockScreen lockScreen
        -ScrollPane scrollPane
        +LockScreenLayout(Stage stage, Runnable onUnlock)
        +getTitleBar() CustomTitleBar
        +refreshTheme() void
    }

    class OperationsView {
        -OperationsController controller
        -OperationTableView tableView
        -StackPane contentArea
        -VBox emptyState
        +OperationsView(OperationsController controller)
    }

    class TasksView {
        -TasksController controller
        -TasksToolbar toolbar
        -TasksFilterPanel filterPanel
        -GlobalTasksKanban kanban
        -TasksCardView cardView
        -TasksTimelineView timelineView
        -TasksEisenhowerView eisenhowerView
        -BatchOperationsBar batchBar
    }

    class WikiView {
        -WikiController controller
        -WikiToolbar toolbar
        -WikiSidebar sidebar
        -WikiFullEditor editor
    }

    class HomeView {
        -TaskService taskService
        -OperationService operationService
        -WikiService wikiService
        -CalendarService calendarService
        -JournalService journalService
        -RegionRepository regionRepository
        -TaskRepository taskRepository
    }

    class SearchView {
        -List~SearchResult~ results
    }

    class SettingsView {
        -SettingsService settingsService
        -SecurityContext securityContext
        -DataService dataService
        -WikiController wikiController
        -JournalController journalController
        -CalendarController calendarController
        -OperationsController operationsController
    }

    class WikiKeepView {
        -WikiController controller
        -WikiNoteModal noteModal
    }

    class OperationDetailView {
        -OperationDetailController controller
        -CalendarController calendarController
        -WikiController wikiController
        -OperationInfoCard infoCard
        -WikiNoteModal noteModal
    }

    %% ==================== RELATIONSHIPS ====================

    MainLayout *-- ViewFactory
    MainLayout *-- NavigationManager
    MainLayout *-- FloatingNavBar
    MainLayout *-- CustomTitleBar

    RoamApplication ..> MainLayout

    CalendarController *-- CalendarService
    CalendarController *-- CalendarEventRepository
    CalendarController *-- CalendarSourceRepository
    CalendarController *-- OperationRepository
    CalendarController *-- TaskRepository
    CalendarController *-- RegionRepository
    CalendarController *-- WikiRepository
    CalendarController o-- CalendarSource
    CalendarController o-- CalendarEvent

    JournalController *-- JournalService
    JournalController *-- JournalTemplateRepository
    JournalController ..> JournalEntry
    JournalController ..> JournalTemplate

    OperationDetailController *-- OperationRepository
    OperationDetailController *-- TaskRepository
    OperationDetailController *-- WikiRepository
    OperationDetailController *-- RegionRepository
    OperationDetailController *-- CalendarEventRepository
    OperationDetailController *-- Operation
    OperationDetailController ..> Task
    OperationDetailController ..> Wiki

    OperationsController *-- OperationService
    OperationsController *-- RegionRepository
    OperationsController ..> Operation

    TasksController *-- TaskService
    TasksController *-- TaskRepository
    TasksController *-- OperationRepository
    TasksController *-- RegionRepository
    TasksController *-- CalendarEventRepository
    TasksController *-- WikiRepository
    TasksController *-- TaskFilter
    TasksController o-- Task
    TasksController ..> TaskStats

    WikiController *-- WikiService
    WikiController *-- WikiTemplateRepository
    WikiController *-- OperationRepository
    WikiController *-- RegionRepository
    WikiController *-- TaskRepository
    WikiController *-- CalendarEventRepository
    WikiController *-- Wiki
    WikiController o-- Wiki
    WikiController o-- Operation
    WikiController ..> WikiTemplate

    NavigationManager *-- ViewFactory
    NavigationManager *-- Operation
    NavigationManager ..> SearchResult

    CalendarServiceImpl ..|> CalendarService
    CalendarServiceImpl *-- CalendarEventRepository
    CalendarServiceImpl *-- TaskRepository
    CalendarServiceImpl *-- SearchService

    JournalServiceImpl ..|> JournalService
    JournalServiceImpl *-- JournalEntryRepository
    JournalServiceImpl *-- SearchService

    OperationServiceImpl ..|> OperationService
    OperationServiceImpl *-- OperationRepository
    OperationServiceImpl *-- CalendarEventRepository
    OperationServiceImpl *-- TaskRepository
    OperationServiceImpl *-- SearchService

    TaskServiceImpl ..|> TaskService
    TaskServiceImpl *-- TaskRepository
    TaskServiceImpl *-- SearchService

    WikiServiceImpl ..|> WikiService
    WikiServiceImpl *-- WikiRepository
    WikiServiceImpl *-- SearchService

    DataInitializer *-- WikiTemplateRepository
    DataInitializer *-- RegionRepository

    DataService *-- OperationRepository
    DataService *-- TaskRepository
    DataService *-- RegionRepository
    DataService *-- CalendarEventRepository
    DataService *-- CalendarSourceRepository
    DataService *-- WikiRepository
    DataService *-- WikiTemplateRepository
    DataService *-- JournalEntryRepository
    DataService *-- JournalTemplateRepository
    DataService ..> ExportResult
    DataService ..> ImportResult

    OperationRepository *-- ValidationService
    WikiRepository *-- ValidationService

    ServiceFactory *-- TaskService
    ServiceFactory *-- OperationService
    ServiceFactory *-- WikiService
    ServiceFactory *-- CalendarService
    ServiceFactory *-- JournalService

    SettingsService *-- Settings
    SearchService ..> SearchFilter

    CalendarView *-- CalendarController
    CalendarView ..> CalendarEvent

    JournalView *-- JournalController
    JournalView *-- JournalEntry

    LockScreenLayout *-- CustomTitleBar
    LockScreenLayout *-- LockScreen

    OperationsView *-- OperationsController
    OperationsView o-- Operation

    TasksView *-- TasksController
    WikiView *-- WikiController

    HomeView *-- TaskService
    HomeView *-- OperationService
    HomeView *-- WikiService
    HomeView *-- CalendarService
    HomeView *-- JournalService
    HomeView *-- RegionRepository
    HomeView *-- TaskRepository
    HomeView o-- Task
    HomeView o-- Wiki
    HomeView o-- Operation
    HomeView o-- CalendarEvent
    HomeView ..> Region

    SettingsView *-- SettingsService
    SettingsView *-- SecurityContext
    SettingsView *-- DataService
    SettingsView *-- WikiController
    SettingsView *-- JournalController
    SettingsView *-- CalendarController
    SettingsView *-- OperationsController

    WikiKeepView *-- WikiController

    OperationDetailView *-- OperationDetailController
    OperationDetailView *-- CalendarController
    OperationDetailView *-- WikiController
    OperationDetailView ..> CalendarEvent
    OperationDetailView ..> Task
    OperationDetailView ..> Wiki
    OperationDetailView ..> Operation
